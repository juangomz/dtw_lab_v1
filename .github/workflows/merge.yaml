name: Feature Branches & Merge Worflow
run-name: "Build and Test by @${{ github.actor }}"
on:
  push:
    branches:
      -main

env:
  LOGIN_SERVER: ${{ secrets.LOGIN_SERVER }}
  TEAM_NUMBER: ${{ vars.TEAM_NUMBER }}
  RESOURCE_GROUP: ${{ vars.RESOURCE_GROUP }}
permissions: read-all
jobs:
  unit-build-and-integration:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: Install Poetry
      run: |
        curl -sSL https://install.python-poetry.org | python3 -
        echo "$HOME/.local/bin" >> $GITHUB_PATH

    - name: Install dependencies
      run: poetry install

    - name: Set up Docker
      uses: docker/setup-buildx-action@v2

    - name: Set up Docker
      uses: docker/setup-buildx-action@v2

    - name: Run unit tests
      run: poetry run pytest

    - name: Build Docker image
      run: |
        docker build -t team5 .

    - name: Run integration tests
      run: |
        chmod +x ./scripts/build.sh
        chmod +x ./scripts/integration_test.sh
        chmod +x ./scripts/release.sh
        chmod +x ./scripts/deploy.sh
    - name: Run e2e test
      run: |
        chmod +x ./scripts/e2e_test.sh
